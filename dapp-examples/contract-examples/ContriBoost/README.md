# Contribution System Contract

## Deployed contract Addresses
- [Smart Contract Address for Contribution System](https://baobab.klaytnscope.com/account/0x4a16834828a148371a5cbf41340b6bdbb313aa4d?tabId=contractCode): `0x4a16834828a148371a5cbf41340b6bdbb313aa4d`
- [Factory Contract Address for Contribution System](https://baobab.klaytnscope.com/account/0x90a77a567c4ebc6c1fef3dcbdc61ff94f1a16ea2?tabId=contractCode): `0x90a77a567c4ebc6c1fef3dcbdc61ff94f1a16ea2`

This Solidity contract is a contribution system that allows participants to join, deposit funds, and then distributes those funds randomly among the participants at the end of each segment. Let's break down the code:

## Contract Structure
- The contract is named `ContributionSystem`.
- It uses Solidity version `^0.8.19`.
- The SPDX-License-Identifier is set to MIT, indicating the license under which the contract's code is available.

## State Variables
- `host`: Stores the address of the contract deployer, who is also the host of the contribution system.
- `dayRange`: Represents the duration of each segment in days.
- `expectedNumber`: Specifies the expected number of participants.
- `currentSegment`: Tracks the current segment.
- `contributionAmount`: Indicates the expected amount each participant should contribute.
- `tokenAddress`: Stores the address of the ERC20 token used for contributions.
- `participants`: Maps participant addresses to their Participant struct.
- `participantList`: Stores the addresses of all participants.
- `totalAmount`: Total amount of tokens in the contract.

## Participant Struct
Defines the `Participant` struct with fields for id, depositAmount, lastDepositTime, existence status, and whether they've received funds.

## Events
- `Deposit`: Triggered when a participant makes a deposit.
- `FundsTransferred`: Triggered when funds are transferred from the contract to a participant.
- `SegmentEnd`: Triggered when a segment ends.
- `RandomNumberGenerated`: Triggered when a random number is generated.

## VRF (Verifiable Random Function)
- The contract inherits from `VRFConsumerBase` to implement the VRF feature.
- `COORDINATOR`: A reference to the VRF Coordinator.
- `keyHash`: A unique key hash for VRF request.
- `fee`: The fee required to make a request.
- `sRandomWord`: Holds the random number generated by the VRF.

## Constructor
Initializes contract variables including `host`, `dayRange`, `expectedNumber`, `contributionAmount`, and `tokenAddress`. It also initializes VRF related variables.

## Modifiers
- `onlyHost`: Restricts access to functions only to the contract host.
- `canJoin`: Ensures that only non-participants can join.

## Functions
- `join`: Allows participants to join the system by adding them to `participantList`.
- `deposit`: Allows participants to deposit funds into the contract.
- `distributeFunds`: Distributes funds to a random participant at the end of each segment, deducts 2% as the host share, and increments the segment count.
- `getRandomParticipant`: Returns a random participant from the `participantList`.
- `withdraw`: Allows the contract host to withdraw remaining funds.
- `requestRandomWords`: Requests a random number from the VRF Coordinator.
- `fulfillRandomWords`: Callback function that fulfills the random number request and transfers funds to the randomly chosen participant.

## ContributionSystemFactory Contract
This contract allows deploying multiple instances of the `ContributionSystem` contract.

## Functions
- `createContributionSystem`: Allows creating a new instance of the `ContributionSystem` contract.
- `getDeployedSystems`: Returns the list of deployed systems.
- `getSystemsByCreator`: Returns the list of systems deployed by a specific creator.

## Explanation of Changes
- The `distributeFunds` function now checks if the expected number of participants has been met before distributing funds.
- The `deposit` function allows participants to deposit funds incrementally over the day range.

This contract aims to create a fair and transparent contribution system where funds are distributed randomly among participants at the end of each segment.
